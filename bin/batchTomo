#!/usr/bin/env lua
--[[===========================================================================#
# This is a program to run tomoAuto in batch to align and reconstruct a large  #
# number of raw image stacks.                                                  #
#------------------------------------------------------------------------------#
# Author: Dustin Morado                                                        #
# Written: March 24th 2014                                                     #
# Contact: dustin.morado@uth.tmc.edu                                           #
#------------------------------------------------------------------------------#
# Arguments: arg[1] = fiducial size in nm <integer>                            #
#===========================================================================--]]
rootDir = os.getenv('TOMOAUTOROOT')
local lfs = assert(require 'lfs')
local tomoAuto = assert(dofile(rootDir .. '/lib/tomoAuto.lua'))
local getOpt = assert(dofile(rootDir .. '/lib/getOpt.lua'))

shortString = 'c, d_, g, h, L_, p_, z_'
longString = 'ctf, defocus, gpu, help, config, procnum, thickness'
local arg, Opts = getOpt.parse(arg, shortString, longString)

for file in lfs.dir('.') do

   if file:find('%w+%.st$') then
      tomoAuto.reconstruct(file, arg[1], Opts)
   end

end
